setwd("C:/Users/Cole/tmb_workshop/day1")
library(TMB)
compile("../TMB_models/polynomial.cpp")
compile("../TMB_models/polynomial.cpp")
dyn.load(dynlib("../TMB_models/polynomial"))
obj <- MakeADFun(data=list(), parameters=list(x=0), DLL='polynomial')
obj$fn(5)
obj$gr(5)
x <- seq(-3,2, len=200)
y <- g <- rep(NA, 200)
for(i in 1:length(x)) {
y[i] <- obj$fn(x[i])
g[i] <- obj$gr(x[i])
}
par(mfrow=c(1,2))
plot(x,y, type='l', lwd=2, main='Height', ylab='fn')
plot(x,g, type='l', lwd=2, main='Derivative', ylab='gr')
abline(h=0)
plot_derv <- function(x, eps=.15, col=2){
y <- obj$fn(x)
g <- obj$gr(x)
points(x,y,pch=16)
xx <- c(x-eps, x+eps)
yy <- c(y-eps*g, y+eps*g)
lines(xx,yy, col=col, lwd=2.5)
}
par(mfrow=c(1,1))
plot(x,y, main='Height', type='n')
plot_derv(1.13)
plot_derv(-2.5)
plot_derv(0.13)
plot_derv(-2)
plot_derv(-1)
opt <- nlminb(start=1, objective=obj$fn, gradient=obj$gr, lower=-3, upper=3)
plot_derv(opt$par, col=4)
lines(x,y, col=gray(.5))
lines(x,y, lwd=2, col=gray(.5))
par(mfrow=c(1,1))
plot(x,y, main='Height', type='n')
lines(x,y, lwd=2, col=gray(.5))
plot_derv(1.13)
plot_derv(-2.5)
plot_derv(0.13)
plot_derv(-2)
plot_derv(-1)
opt <- nlminb(start=1, objective=obj$fn, gradient=obj$gr, lower=-3, upper=3)
plot_derv(opt$par, col=4)
plot(x,y, main='Height', type='n')
lines(x,y, lwd=2, col=gray(.5))
plot_derv(1.13)
plot_derv(-2.5)
plot_derv(0.13)
plot_derv(-2)
plot_derv(-1)
opt <- nlminb(start=1, objective=obj$fn, gradient=obj$gr, lower=-3, upper=3)
plot_derv(opt$par, col=4)
